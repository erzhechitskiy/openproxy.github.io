(function(){var GoogleMapsPopover,proxySwitchEnabled,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};GoogleMapsPopover=function(_super){function GoogleMapsPopover(options){this._el=$("<div class='google-maps-popover' style='display: none'></div>")[0],this._margin={x:options.marginByX||4,y:options.marginByY||4},options.content&&this.content(options.content),this.setMap(options.map||function(){throw new Error('"map" is required')}())}return __extends(GoogleMapsPopover,_super),GoogleMapsPopover.prototype.onAdd=function(){var eventType,stopPropagationListener,_i,_len,_ref;for(stopPropagationListener=function(e){return e.stopPropagation()},_ref=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],_i=0,_len=_ref.length;_len>_i;_i++)eventType=_ref[_i],google.maps.event.addDomListener(this._el,eventType,stopPropagationListener);return google.maps.event.addDomListener(this._el,"contextmenu",function(){return!1}),google.maps.event.addDomListener(this._el,"mouseover",function(){return this.style.cursor="default"}),this.getPanes().floatPane.appendChild(this._el)},GoogleMapsPopover.prototype.draw=function(){var computedStyle,position,width;if(this._visible)return $(".gm-style").removeClass("gm-style"),position=this.getProjection().fromLatLngToDivPixel(this._position),computedStyle=this._el.ownerDocument.defaultView.getComputedStyle(this._el,null),width=parseInt(computedStyle.getPropertyValue("width"),10),isNaN(width)||(position.x-=width/2),this._el.style.position="absolute",this._el.style.left=position.x+"px",this._el.style.top=position.y+"px",this._el.style.display=this._visible?"block":"none"},GoogleMapsPopover.prototype.onRemove=function(){return this._el?(this._el.parentNode.removeChild(this._el),this._el=null):void 0},GoogleMapsPopover.prototype.show=function(anchor){return anchor instanceof google.maps.Marker?this._position=anchor.getPosition():anchor instanceof google.maps.LatLng&&(this._position=anchor),this._visible=!0,this.draw(),this.moveIntoViewport()},GoogleMapsPopover.prototype.moveIntoViewport=function(){var $el,halfOfTheWidth,height,mapDiv,mapHeight,mapWidth,marginByX,marginByY,markerPosition,offsetByX,offsetByY,width,_ref,_ref1,_ref2;return $el=$(this._el),width=parseInt($el.outerWidth(!0),10),height=parseInt($el.outerHeight(!0),10),mapDiv=this.getMap().getDiv(),_ref=[mapDiv.offsetWidth,mapDiv.offsetHeight],mapWidth=_ref[0],mapHeight=_ref[1],_ref1=[this._margin.x,this._margin.y],marginByX=_ref1[0],marginByY=_ref1[1],_ref2=[0,0],offsetByX=_ref2[0],offsetByY=_ref2[1],halfOfTheWidth=width/2,markerPosition=this.getProjection().fromLatLngToContainerPixel(this._position),markerPosition.x<marginByX+halfOfTheWidth?offsetByX=markerPosition.x-marginByX-halfOfTheWidth:markerPosition.x+halfOfTheWidth+marginByX>mapWidth&&(offsetByX=markerPosition.x+halfOfTheWidth+marginByX-mapWidth),markerPosition.y+height+marginByY>mapHeight&&(offsetByY=markerPosition.y+height+marginByY-mapHeight),0!==offsetByX||0!==offsetByY?this.getMap().panBy(offsetByX,offsetByY):void 0},GoogleMapsPopover.prototype.content=function(content){return $(this._el).html(content),this},GoogleMapsPopover.prototype.hide=function(){return this._visible=!1,this._el.style.display="none"},GoogleMapsPopover.prototype.destroy=function(){return google.maps.event.clearInstanceListeners(this._el),this.setMap(null)},GoogleMapsPopover}(google.maps.OverlayView),$.getWithYQL=function(url,callback){var query;return query=encodeURIComponent('select * from html where url="'+url+'"'),$.getJSON("//query.yahooapis.com/v1/public/yql?q="+query+"&format=xml&callback=?",function(response){var _ref;return callback(null!=(_ref=response.results)?_ref[0]:void 0)})},proxySwitchEnabled=!1,window.addEventListener("message",function(event){return"OP_CHROME_EXTENSION_INITIALIZED"===event.data.type?proxySwitchEnabled=!0:void 0}),google.maps.event.addDomListener(window,"load",function(){var doubleClickCatcher,findCountry,geocoder,hidden,infoTemplate,map,mapClickListener,marker,popover,veil;return google.maps.visualRefresh=!0,hidden=function(feature){return{featureType:feature,stylers:[{visibility:"off"}]}},map=new google.maps.Map(document.getElementById("map-container"),{zoom:3,center:new google.maps.LatLng(32,0),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},styles:[hidden("administrative.province"),hidden("administrative.locality"),hidden("administrative.neighborhood"),hidden("road"),hidden("poi"),hidden("transit")]}),google.maps.event.addListener(map,"zoom_changed",function(min,max){return function(){var zoom;return zoom=map.getZoom(),min>zoom?map.setZoom(min):zoom>max?map.setZoom(max):void 0}}(3,6)),veil=function(){var $veil;return $veil=$('<div class="veil" style="display: none"><div class="center"></div></div>').appendTo($(document.body)),new Spinner({lines:13,length:0,radius:60,trail:60}).spin($veil.find(".center")[0]),function(state){return $veil[state?"fadeIn":"fadeOut"]()}}(),geocoder=new google.maps.Geocoder,findCountry=function(latLng){var deferred;return deferred=new $.Deferred,geocoder.geocode({latLng:latLng},function(records,status){var record,_i,_len;if(status===google.maps.GeocoderStatus.OK)for(_i=0,_len=records.length;_len>_i;_i++)if(record=records[_i],-1!==record.types.indexOf("country"))return deferred.resolve(record);return deferred.reject()}),deferred},mapClickListener=function(event){var deferredCountry;return map.setCenter(event.latLng),popover.hide(),veil(!0),deferredCountry=findCountry(event.latLng).done(function(country){var countryCode,deferredProxyCollection,url;return countryCode=country.address_components[0].short_name,url="http://www.xroxy.com/proxylist.php?type=transparent&country="+countryCode+"&sort=latency",deferredProxyCollection=$.getWithYQL(url,function(data){var $response,proxyCollection;return proxyCollection=[],$response=$((new DOMParser).parseFromString(null!=data?data:"","text/xml")),$(".row0, .row1",$response).each(function(){var tdl;return tdl=$(this).find("td a"),proxyCollection.push({host:$.trim($(tdl[1]).text()),port:parseInt($(tdl[2]).text(),10),type:$(tdl[3]).text()})}),popover.content(infoTemplate(proxyCollection)).show(country.geometry.location),proxySwitchEnabled&&$(".google-maps-popover").on("click",".proxy-switch",function(event){var proxy,proxyIndex;return proxyIndex=$(event.target).closest("tr").attr("data-index"),proxy=proxyCollection[proxyIndex],window.postMessage({type:"OP_PROXY_ON",body:proxy},"*"),!1}),veil(!1)}),deferredProxyCollection.fail(function(){return veil(!1)})}),deferredCountry.fail(function(){return veil(!1)})},doubleClickCatcher=null,google.maps.event.addListener(map,"click",function(event){return doubleClickCatcher=setTimeout(function(){return mapClickListener(event)},250)}),google.maps.event.addListener(map,"dblclick",function(){return clearTimeout(doubleClickCatcher)}),infoTemplate=function(proxies){var i,proxy,trc;return 0===proxies.length?"            <span class='google-maps-popover-arrow-up'></span>            <div style='text-align: center;'>No proxies in this location</div>            ":(trc=proxySwitchEnabled?"proxy-switch":"","            <span class='google-maps-popover-arrow-up'></span>            <table style='width: 100%;'>                <thead><tr><th>Host</th><th>Port</th><th>Type</th></tr></thead>                <tbody>                    "+function(){var _i,_len,_results;for(_results=[],i=_i=0,_len=proxies.length;_len>_i;i=++_i)proxy=proxies[i],_results.push('<tr class="'+trc+'" data-index="'+i+'"><td>'+proxy.host+"</td><td>&nbsp;&nbsp;"+proxy.port+"&nbsp;&nbsp;</td><td>"+proxy.type+"</td></tr>");return _results}().join("")+"                </tbody>            </table>            ")},marker=new google.maps.Marker({map:map}),popover=new GoogleMapsPopover({map:map}),google.maps.event.addListener(marker,"click",function(event){return mapClickListener(event)}),$.getJSON("http://freegeoip.net/json/?callback=?",function(data){var clientLatLng;return clientLatLng=new google.maps.LatLng(data.latitude,data.longitude),findCountry(clientLatLng).done(function(country){return marker.setPosition(country.geometry.location),map.setCenter(marker.getPosition())})})})}).call(this);